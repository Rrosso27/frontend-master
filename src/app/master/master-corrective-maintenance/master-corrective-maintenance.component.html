<!-- Perfil Usuario Asignador -->
<div *ngIf="profileAssign" class="row">

  <div class="col-sm-12">
    <app-card>
      <h5>Administración de Mantenimiento Correctivo</h5>
      <br>

      <div class="form-group row">

        <div class="col-sm-6">
          <h6>Cliente <span style="color:red;">*</span></h6>
          <select class="form-control" (change)="getBranchOfficeUser()" [(ngModel)]="selectedBusinessId">
            <option value="0" selected>Seleccionar cliente </option>
            <option *ngFor="let customer of customers" [ngValue]="customer"> {{customer.business_name}} </option>
            <!--  <option value="0" selected>Seleccionar perfil</option> -->
          </select>
        </div>

        <div class="col-sm-4">
          <h6>Sede <span style="color:red;">*</span></h6>
          <select class="form-control" (change)="getForklifs()" [(ngModel)]="selectedBranchOfficeId">
            <option value="0" selected>Seleccionar sede </option>
            <option *ngFor="let branchOffice of branchOffices" [ngValue]="branchOffice"> {{branchOffice.branch_name}}
            </option>
            <!--  <option value="0" selected>Seleccionar perfil</option> -->
          </select>
        </div>
      </div>

      <div class="form-group row">
        
        <div class="col-sm-4">
          <h6>Equipo <span style="color:red;">*</span></h6>

          <select class="form-control" [(ngModel)]="selectedForkliftId">
            <option value="0" selected>Seleccionar equipo </option>
            <option *ngFor="let forklift of forklifts" [ngValue]="forklift"> {{forklift.full_name}} </option>
            <!--  <option value="0" selected>Seleccionar perfil</option> -->
          </select>
        </div>

        <div class=" align-buttons">
          <button type="button" style="display:none;" id="showUpdateCorrective" (click)="modalUpdateCorrective.show()"
            class="btn btn-primary waves-effect">Checkear</button>
          <br>
          <button class="btn btn-primary" (click)="getCorrectiveRoutinesUser()"><i
              class="icofont icofont-search"></i>Buscar</button>
        </div>
      </div>


      <br>
      <div class=" align-buttons">
        <div>

          <button class="btn btn-primary" (click)="showAssingProfile()">Crear</button>
          <button style="display: none;" id="showAssing" class="btn btn-primary" (click)="modalAssingCorrective.show()"
            (click)="getConsecutive()">Crear</button>
        </div>
      </div>

      <ngx-datatable #table class="data-table" [rows]="row" [columnMode]="'flex'" [headerHeight]="50"
        [footerHeight]="50" [rowHeight]="'auto'" [limit]="20">

        <ngx-datatable-column [flexGrow]="2" [sortable]="false" [resizeable]="false" name="Obervación"
          [sortable]="false" prop="result.corrective.description"></ngx-datatable-column>
        <ngx-datatable-column [flexGrow]="2" [sortable]="false" [resizeable]="false" name="Fecha" [sortable]="false"
          prop="result.corrective.date"></ngx-datatable-column>
        <ngx-datatable-column [flexGrow]="2" name="Ver" [sortable]="false" sortable="false" prop="status">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>

            <button (click)="update(row)" (click)="getConsecutive()" class="btn btn-primary btn-icon"><i
                class="icofont icofont-pencil-alt-5"></i></button>
            <button (click)="deleteEstimateDetail(row)" class="btn btn-danger btn-icon"><i
                class="icofont icofont-ui-delete"></i></button>

          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>

    </app-card>
  </div>
</div>

<!-- Perfil Normal -->
<div *ngIf="!profileAssign" class="row">

  <div class="col-sm-12">
    <app-card>
      <h5>Administración de Mantenimiento Correctivo</h5>
      <br>

      <div class="form-group row">

        <div class="col-sm-6">
          <h6>Sucursales <span style="color:red;">*</span> </h6>

          <select class="form-control" (change)="getCustomerRegionals()" [(ngModel)]="selectedRegionalId">
            <option value="0" selected>Seleccionar sucursal </option>
            <option *ngFor="let reg of regional" [ngValue]="reg"> {{reg.description}} </option>
            <!--  <option value="0" selected>Seleccionar perfil</option> -->
          </select>
        </div>

        <div class="col-sm-6">
          <h6>Cliente <span style="color:red;">*</span></h6>
          <select class="form-control" (change)="getBranchOffices()" [(ngModel)]="selectedBusinessId">
            <option value="0" selected>Seleccionar cliente </option>
            <option *ngFor="let customer of customers" [ngValue]="customer"> {{customer.business_name}} </option>
            <!--  <option value="0" selected>Seleccionar perfil</option> -->
          </select>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-sm-4">
          <h6>Sede <span style="color:red;">*</span></h6>
          <select class="form-control" (change)="getForklifs()" [(ngModel)]="selectedBranchOfficeId">
            <option value="0" selected>Seleccionar sede </option>
            <option *ngFor="let branchOffice of branchOffices" [ngValue]="branchOffice"> {{branchOffice.branch_name}}
            </option>
            <!--  <option value="0" selected>Seleccionar perfil</option> -->
          </select>
        </div>

        <div class="col-sm-4">
          <h6>Equipo <span style="color:red;">*</span></h6>

          <select class="form-control" [(ngModel)]="selectedForkliftId">
            <option value="0" selected>Seleccionar equipo </option>
            <option *ngFor="let forklift of forklifts" [ngValue]="forklift"> {{forklift.full_name}} </option>
            <!--  <option value="0" selected>Seleccionar perfil</option> -->
          </select>
        </div>

        <div class=" align-buttons">
          <button type="button" style="display:none;" id="showUpdateCorrective" (click)="modalUpdateCorrective.show()"
            class="btn btn-primary waves-effect">Checkear</button>
          <br>
          <button class="btn btn-primary" (click)="getCorrectiveRoutines()"><i
              class="icofont icofont-search"></i>Buscar</button>
        </div>
      </div>


      <br>
      <div class=" align-buttons">
        <div>

          <button class="btn btn-primary" (click)="showAssing()">Crear</button>
          <button style="display: none;" id="showAssing" class="btn btn-primary" (click)="modalAssingCorrective.show()"
            (click)="getConsecutive()">Crear</button>
        </div>
      </div>

      <ngx-datatable #table class="data-table" [rows]="row" [columnMode]="'flex'" [headerHeight]="50"
        [footerHeight]="50" [rowHeight]="'auto'" [limit]="20">

        <ngx-datatable-column [flexGrow]="2" [sortable]="false" [resizeable]="false" name="Obervación"
          [sortable]="false" prop="result.corrective.description"></ngx-datatable-column>
        <ngx-datatable-column [flexGrow]="2" [sortable]="false" [resizeable]="false" name="Fecha" [sortable]="false"
          prop="result.corrective.date"></ngx-datatable-column>
        <ngx-datatable-column [flexGrow]="2" name="Ver" [sortable]="false" sortable="false" prop="status">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>

            <button (click)="update(row)" (click)="getConsecutive()" class="btn btn-primary btn-icon"><i
                class="icofont icofont-pencil-alt-5"></i></button>
            <button (click)="deleteEstimateDetail(row)" class="btn btn-danger btn-icon"><i
                class="icofont icofont-ui-delete"></i></button>

          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>

    </app-card>
  </div>
</div>


<app-modal-basic #modalAssingCorrective [dialogClass]="'modal-lg'">
  <div class="app-modal-header">

    <h4 class="modal-title">Asignación de Mantenimiento</h4>
  </div>
  <div class="app-modal-body">

    <div class="form-group row">

      <div class="col-4">
        <h6>Fecha de asignación</h6>
        <div class="input-group" dir="ltr">
          <input class="form-control" placeholder="dd-mm-yyyy" [readonly]="true" name="fd" [(ngModel)]="untilDate"
            ngbDatepicker #dUntil="ngbDatepicker" (dateSelect)="onDateSelectionFrom($event)">
          <button type="button" class="btn btn-primary waves-effect" (click)="dUntil.toggle()"><i
              class="icofont icofont-ui-calendar"></i></button>
        </div>
      </div>


      <div class="col-8">

        <h6>Horas de asignación</h6>
        <div class="row">
          <div class="col-5">
            <select class="form-control" [(ngModel)]="selectedHourPreventive">
              <option value="0">00</option>
              <option value="1">01</option>
              <option value="2">02</option>
              <option value="3">03</option>
              <option value="4">04</option>
              <option value="5">05</option>
              <option value="6">06</option>
              <option value="7">07</option>
              <option value="8">08</option>
              <option value="9">09</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
              <option value="24">24</option>
            </select>
          </div>

          <div><strong>:</strong></div>
          <div class="col-5">
            <select class="form-control" [(ngModel)]="selectedMinutPreventive">
              <option value="0">00</option>
              <option value="1">01</option>
              <option value="2">02</option>
              <option value="3">03</option>
              <option value="4">04</option>
              <option value="5">05</option>
              <option value="6">06</option>
              <option value="7">07</option>
              <option value="8">08</option>
              <option value="9">09</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
              <option value="24">24</option>
              <option value="25">25</option>
              <option value="26">26</option>
              <option value="27">27</option>
              <option value="28">28</option>
              <option value="29">29</option>
              <option value="30">30</option>
              <option value="31">31</option>
              <option value="32">32</option>
              <option value="33">33</option>
              <option value="34">34</option>
              <option value="35">35</option>
              <option value="36">36</option>
              <option value="37">37</option>
              <option value="38">38</option>
              <option value="39">39</option>
              <option value="40">40</option>
              <option value="41">41</option>
              <option value="42">42</option>
              <option value="43">43</option>
              <option value="44">44</option>
              <option value="45">45</option>
              <option value="46">46</option>
              <option value="47">47</option>
              <option value="48">48</option>
              <option value="49">49</option>
              <option value="50">50</option>
              <option value="51">51</option>
              <option value="52">52</option>
              <option value="53">53</option>
              <option value="54">54</option>
              <option value="55">55</option>
              <option value="56">56</option>
              <option value="57">57</option>
              <option value="58">58</option>
              <option value="59">59</option>
            </select>
          </div>
        </div>
      </div>
    </div>



    <div class="form-group row">

      <app-card style="width: 100%; height: 300px;">
        <div style="overflow-y: scroll; height: 300px">
          <h5>Observación</h5>
          <textarea type="text" class="form-control" id="comment" [(ngModel)]="observationCorrective" cols="30"
            rows="10"></textarea>
        </div>
      </app-card>
    </div>
    <br>
    <br>
    <div class="form-group row">
      <app-card style="width: 100%; height: 300px;">
        <div style="overflow-y: scroll; height: 300px">
          <h5>Tecnicos</h5>
          <div *ngFor="let item of technicianSelecteds">
            <input type="checkbox" [(ngModel)]="item.select" data-md-icheck /> {{item.item}}<br>
          </div>
        </div>
      </app-card>
    </div>
    <br>
    <br>
    <div class="align-buttons">
      <button type="button" class="btn btn-default waves-effect" id="hide" (click)="addCancelDate()">Cancelar</button>
      <button type="button" style="display: none;" class="btn btn-default waves-effect" id="assignCorrectiveHide"
        (click)="modalAssingCorrective.hide()">Cancelar</button>
      <button type="submit " class="btn btn-primary m-b-0 " (click)="createCorrective()">Guardar</button>
    </div>
  </div>
</app-modal-basic>


<app-modal-basic #modalUpdateCorrective [dialogClass]="'modal-lg'">
  <div class="app-modal-header">

    <h4 class="modal-title">Actualizar asignación de Mantenimiento</h4>
  </div>
  <div class="app-modal-body">

    <div class="form-group row">

      <div class="col-4">
        <h6>Fecha de asignación</h6>
        <div class="input-group" dir="ltr">
          <input class="form-control" placeholder="dd-mm-yyyy" [readonly]="true" name="fd" [(ngModel)]="fromDate"
            ngbDatepicker #dFrom="ngbDatepicker" (dateSelect)="onDateSelectionFrom($event)">
          <button type="button" class="btn btn-primary waves-effect" (click)="dFrom.toggle()"><i
              class="icofont icofont-ui-calendar"></i></button>
        </div>
      </div>


      <div class="col-8">

        <h6>Horas de asignación</h6>
        <div class="row">
          <div class="col-5">
            <select class="form-control" [(ngModel)]="selectedHourUpdateCorrective">
              <option value="0">00</option>
              <option value="1">01</option>
              <option value="2">02</option>
              <option value="3">03</option>
              <option value="4">04</option>
              <option value="5">05</option>
              <option value="6">06</option>
              <option value="7">07</option>
              <option value="8">08</option>
              <option value="9">09</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
              <option value="24">24</option>
            </select>
          </div>

          <div><strong>:</strong></div>
          <div class="col-5">
            <select class="form-control" [(ngModel)]="selectedMinutUpdateCorrective">
              <option value="0">00</option>
              <option value="1">01</option>
              <option value="2">02</option>
              <option value="3">03</option>
              <option value="4">04</option>
              <option value="5">05</option>
              <option value="6">06</option>
              <option value="7">07</option>
              <option value="8">08</option>
              <option value="9">09</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
              <option value="24">24</option>
              <option value="25">25</option>
              <option value="26">26</option>
              <option value="27">27</option>
              <option value="28">28</option>
              <option value="29">29</option>
              <option value="30">30</option>
              <option value="31">31</option>
              <option value="32">32</option>
              <option value="33">33</option>
              <option value="34">34</option>
              <option value="35">35</option>
              <option value="36">36</option>
              <option value="37">37</option>
              <option value="38">38</option>
              <option value="39">39</option>
              <option value="40">40</option>
              <option value="41">41</option>
              <option value="42">42</option>
              <option value="43">43</option>
              <option value="44">44</option>
              <option value="45">45</option>
              <option value="46">46</option>
              <option value="47">47</option>
              <option value="48">48</option>
              <option value="49">49</option>
              <option value="50">50</option>
              <option value="51">51</option>
              <option value="52">52</option>
              <option value="53">53</option>
              <option value="54">54</option>
              <option value="55">55</option>
              <option value="56">56</option>
              <option value="57">57</option>
              <option value="58">58</option>
              <option value="59">59</option>
            </select>
          </div>
        </div>
      </div>
    </div>



    <div class="form-group row">

      <app-card style="width: 100%; height: 300px;">
        <div style="overflow-y: scroll; height: 300px">
          <h5>Observación</h5>
          <textarea type="text" class="form-control" id="comment" [(ngModel)]="observationUpdateCorrective" cols="30"
            rows="10"></textarea>
        </div>
      </app-card>
    </div>
    <br>
    <br>
    <div class="form-group row">
      <app-card style="width: 100%; height: 300px;">
        <div style="overflow-y: scroll; height: 300px">
          <h5>Tecnicos</h5>
          <div *ngFor="let item of technicianSelecteds">
            <input type="checkbox" [(ngModel)]="item.select" data-md-icheck /> {{item.item}}<br>
          </div>
        </div>
      </app-card>
    </div>
    <br>
    <br>
    <div class="align-buttons">
      <button type="button" class="btn btn-default waves-effect" id="assignPreveUpdatetiveHide"
        (click)="addCancelUpdateDate()">Cancelar</button>
      <button type="button" style="display: none;" class="btn btn-default waves-effect" id="assignUpdateCorrectiveHide"
        (click)="modalUpdateCorrective.hide()">Cancelar</button>
      <button type="submit " class="btn btn-primary m-b-0 " (click)="updateCorrective()">Guardar</button>
    </div>
  </div>
</app-modal-basic>
